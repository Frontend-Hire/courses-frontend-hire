import { Callout } from 'nextra/components';

# Adding Tasks

Let us add some interactivity by letting the user add tasks to the list. We'll add a text input and a button. When the user clicks the button, we'll add the text from the input to the list of tasks.

## Adding a Text Input and Button

First, let's add a form with an input and a button. The `form` is technically not required, but it gives us the ability to listen to the `submit` event, which is useful for handling form submissions as it adds a couple of extra features like submitting the form when the user presses the `Enter` key.

```ts filename="src/main.ts" {6-9} showLineNumbers
// Rest of the code omitted for brevity

document.querySelector<HTMLDivElement>('#app')!.innerHTML = `
<div>
  <h1>Tasks</h1>
  <form>
    <input />
    <button>Add</button>
  </form>
  <ul>
    ${tasks.map((task) => `<li>${task.title}</li>`)}
  </ul>
</div>
`;
```

Though this is good enough for now, we can and **should** make it more accessible by adding a label for the input and a `for` attribute on the label that matches the `id` of the input.

```ts filename="src/main.ts" {7-8} showLineNumbers
// Rest of the code omitted for brevity

document.querySelector<HTMLDivElement>('#app')!.innerHTML = `
<div>
  <h1>Tasks</h1>
  <form>
    <label for="task-input">Task</label>
    <input id="task-input" />
    <button>Add</button>
  </form>
  <ul>
    ${tasks.map((task) => `<li>${task.title}</li>`)}
  </ul>
</div>
`;
```

Now clicking on the label will focus the input. This is a small change, but it makes a big difference for users who rely on assistive technologies.

## Adding a Task

We need to listen to the `submit` event on the form and add the task to the list of tasks when the form is submitted.

```ts filename="src/main.ts" {17-24} showLineNumbers
// Rest of the code omitted for brevity

document.querySelector<HTMLDivElement>('#app')!.innerHTML = `
<div>
  <h1>Tasks</h1>
  <form>
    <label for="task-input">Task</label>
    <input id="task-input" />
    <button>Add</button>
  </form>
  <ul>
    ${tasks.map((task) => `<li>${task.title}</li>`)}
  </ul>
</div>
`;

document.querySelector('form')!.addEventListener('submit', (event) => {
  event.preventDefault();
  const input = document.querySelector<HTMLInputElement>('#task-input')!;
  const title = input.value;

  tasks.push({ id: Date.now(), title, isCompleted: false });
  input.value = '';
});
```

We're using `event.preventDefault()` to prevent the default behavior of the form, which is to refresh the page. We then get the value of the input and add a new task to the `tasks` array. Finally, we clear the input.

But wait, we're not updating the UI when a new task is added. We need to re-render the list of tasks when a new task is added.

Let us extract the code that renders the list of tasks into a function and call it when a new task is added to the list and also when the page first loads.

```ts filename="src/main.ts" {3-6, 16, 27, 30} showLineNumbers
// Rest of the code omitted for brevity

function renderTasks() {
  const ul = document.querySelector<HTMLUListElement>('ul')!;
  ul.innerHTML = tasks.map((task) => `<li>${task.title}</li>`).join('');
}

document.querySelector<HTMLDivElement>('#app')!.innerHTML = `
<div>
  <h1>Tasks</h1>
  <form>
    <label for="task-input">Task</label>
    <input id="task-input" />
    <button>Add</button>
  </form>
  <ul></ul>
</div>
`;

document.querySelector('form')!.addEventListener('submit', (event) => {
  event.preventDefault();
  const input = document.querySelector<HTMLInputElement>('#task-input')!;
  const title = input.value;

  tasks.push({ id: Date.now(), title, isCompleted: false });
  input.value = '';
  renderTasks();
});

renderTasks();
```

<Callout>
  As discussed in the previous section, unique IDs are usually created by a
  database. In this project, we'll use the [current time in
  milliseconds](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getTime)
  as the ID for each task.
</Callout>

Awesome, but there are a ton of things that can go wrong when a user adds a task. For example, the user can add an empty task.

This gives us a good opportunity to learn about **Testing**. We'll cover testing in the subsequent sections.

At this point, your code should be a good match to the branch of the repository: [3-adding-tasks](https://github.com/Frontend-Hire/todo-app-js-tdd-typescript/tree/3-adding-tasks)
